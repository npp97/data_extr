library(ncdf4)
library(raster)
?extract
path0<-"d://cru.ts//nc" flst <- dir()
flst
path0 <- "d://cru.ts//nc" setwd(path0) flst <- dir()
flst
filen
filename(flst)
?filename(flst)
basen
basename(flst)
nc_readef(flst[1])
nc_readef(flst[1])
nc_re
nc_redef(flst[1])
a<-nc_open(flst[1])
nc_redef(a)
?nc_open
nc_close(a)
a<-nc_open(flst[1])
data<-ncvar_get(a)
summary(data)
data$var
data$var
dim(data)
1368/12
plot(data)
library(ncdf4); library(raster);
path0 <- "d://cru.ts//nc" setwd(path0) flst <- dir() ncdata <- nc_open(flst[1]); data <- ncatt_get(ncdata);
summary(ncdata)
ncdata$dim
ncdata$format
ncdata$lat
ncdata$long
ncdata$lon
380-365
library(chron)
jul
julian('1901-01-01')
Julian('1901-01-01')
?julian
Julian(asDate('1901-01-01'))
julian(asDate('1901-01-01'))
julian(as.Date('1901-01-01'))
julian(as.Date('1901-01-01'))
julian(as.Date('1901-01-01',origin='1900-01-01'))
julian(as.Date('1901-01-01',origin='1900-01-01'))
julian(as.Date(380,origin='1900-01-01'))
as.Date(380,origin='1900-01-01')
as.Date(410,origin='1900-01-01')
as.Date(410,origin='1900-01-01')
as.Date(410,origin='1900-01-01')
ncdata
ncdata$time
ncdata$year
as.Date(439,origin='1900-01-01')
summary(ncdata)
ncdata$dim
?nc_get
?nc_
?nc_close
ncdata$varid
summary(ncdata)
ncdata$var
summary(ncdata)
ncdata$natts
ncdata$dim
ncdata$var
ncdata <- nc_open(flst[1]); data.att <- ncatt_get(ncdata); data<-ncvar_get(ncdata)
data<-ncvar_get(ncdata)
dim(data)
plot(data[,,1])
plot(data[,,1])
class(data)
plot(data[,,1],xlim=c(0,100),yim=c(0,100))
plot(data[,,1],xlim=c(0,100),ylim=c(0,100))
summary(data)
summary(data[,,1])
spplot(data[,,1])
spplot(raster(data[,,1]))
aa<-(raster(data[,,1]))
aa
aa<-(raster(data[,,1:12]))
aa<-(rasterstack(data[,,1:12]))
aa<-(rasterbrick(data[,,1:12]))
?raster
extent(aa)
extent(aa)<-c(-90,90,-180,180)
aa
extent(aa)<-c(-180,180,-90,90)
aa
extent(aa)<-c(-90,90,-180,180)
aa
data[1,1,1:12]
data[1,1:10,1:12]
data[1:10,1:10,1]
?rotate
rotate(aa)
dim(aa)
raster(aa)->bb
rotate(bb)
flip(aa)
flip(aa,2)
flip(aa,1)
rotate(aa,1)
?extract
plot(aa)
extract(aa,data.frame(160,65))
aa
aa<-raster(t(data[,,1]))
plot(aa)
aa<-raster(t(t(data[,,1])))
plot(aa)
aa<-raster(t(t(t(data[,,1]))))
plot(aa)
aa<-raster((t(t(data[,,1]))))
plot(aa)
plot(rotate(aa))
rotate <- function(x) t(apply(x, 2, rev))
plot(raster(rotate(data[,,1])))
plot(raster(rotate(rotate(data[,,1]))))
plot(raster(rotate(rotate(rotate(data[,,1])))))
aa<-(raster(rotate(rotate(rotate(data[,,1])))))
aa
extent(aa)<-c(-180,180,-90,90)
aa
plot(aa,xlim=c(-90,90),ylim=c(-180,180))
plot(aa,xlim=c(-180,180),ylim=c(-90,90))
plot(aa,xlim=c(-180,180),ylim=c(-90,90))
aa
data.att$time
data.att$var
data.att
data.att
ls()
data.att <- ncatt_get(ncdata);
data.att <- ncatt_get(ncdata,1);
data.att <- ncatt_get(ncdata,0);
data.att
ncdata$time
ncdata
summary(ncdata)
summary(ncdata)
ncdata$dim
ncdata$dim[[3]]
ncdata$dim[[3]]$vals
as.Date(ncdata$dim[[3]]$vals)
as.Date(ncdata$dim[[3]]$vals,origin='1900-01-01')
year(as.Date(ncdata$dim[[3]]$vals,origin='1900-01-01'))
years(as.Date(ncdata$dim[[3]]$vals,origin='1900-01-01'))
as.numeric(years(as.Date(ncdata$dim[[3]]$vals,origin='1900-01-01')))
(years(as.Date(ncdata$dim[[3]]$vals,origin='1900-01-01')))
as.character(years(as.Date(ncdata$dim[[3]]$vals,origin='1900-01-01')))
as.numeric(as.character(years(as.Date(ncdata$dim[[3]]$vals,origin='1900-01-01'))))
?stcak
?stack
brick(data[,,1:12])
roatate(brick(data[,,1:12]))
rotate(brick(data[,,1:12]))
brick(aa)
brick(aa)->aa1
brick(aa,aa1)->aa1
brick(aa,aa1)->aa1
aa1
plot(aa)
plot(data[,,1])
plot(raster(data[,,1]))
aa<-(raster(data[,,1]))
extent(aa)<-c(-180,180,-90,90)
plot(aa)
extent(aa)<-c(-90,90,-180,180)
plot(aa)
baa<-brick(data[,,1:12])
extent(baa)<-c(-90,90,-180,180)
plot(baa)
plot(baa[1])
plot(baa[[1]])
baa
extract(baa,c(75,25))
extract(baa,data.frame(c(75,25)))
extract(baa,data.frame(c(75,25)))
?extract
?extract
baa
extent(baa)<-c(-90,90,180,-180)
baa
plot(baa[1])
plot(baa[[1]])
plot(baa[[1]])
plot(baa[[1]])
data_brick <- brick(data[,, ii])
data_brick <- brick(data[,, 1:12])
plot(data_brick[[1]])
aa <- (raster(rotate(rotate(rotate(data[,,1])))))
aa
plot(aa)
extent(aa)<-c(-180,180,-90,90)
plot(aa)
baa[[1]]
ls()
data_brick[[1]]
rotate(data_brick[[1]])
data_brick<-data[,,1:12]
bba<-brick(rotate(rotate(rotate(data_brick[[1]]))))
bba<-brick(rotate(rotate(rotate(data_brick[,,1]))))
data_brick <- data[,,ii]
data_brick <- data[,,1:12]
bba<-brick(rotate(rotate(rotate(data_brick[,,1]))))
bba<-(rotate(rotate(rotate(data_brick[,,1]))))
bba<-(rotate(rotate(rotate(data_brick[,,1])))) for (i in 2:length(ii)) {     bba <- brick(bba, (rotate(rotate(rotate(data_brick[,, 1]))))) }
ii=1:12
bba<-(rotate(rotate(rotate(data_brick[,,1])))) for (i in 2:length(ii)) {     bba <- brick(bba, (rotate(rotate(rotate(data_brick[,, 1]))))) }
bba<-(rotate(rotate(rotate(data_brick[,,1])))) for (i in 2:length(ii)) {     bba <- brick(bba, raster(rotate(rotate(rotate(data_brick[,, 1]))))) }
bba<-rotate(rotate(rotate(data_brick[,,1]))) for (i in 2:length(ii)) {     ccc <- raster(rotate(rotate(rotate(data_brick[,, 1]))))     bba <- brick(bba, ccc) }
bba<-rotate(rotate(rotate(data_brick[,,1]))) for (i in 2:length(ii)) {     ccc <- raster(rotate(rotate(rotate(data_brick[,,i]))))     bba <- brick(bba, ccc) }
bba<-rotate(rotate(rotate(data_brick[,,1]))) for (i in 2:length(ii)) {     ccc <- raster(rotate(rotate(rotate(data_brick[,,i]))))     #bba <- brick(bba, ccc) }
bba
rm(bba)
bba<-brick(rotate(rotate(rotate(data_brick[,,1])))) for (i in 2:length(ii)) {     ccc <- raster(rotate(rotate(rotate(data_brick[,, i]))));     bba <- brick(bba, ccc); }
bba<-raster(rotate(rotate(rotate(data_brick[,,1])))) for (i in 2:length(ii)) {     ccc <- raster(rotate(rotate(rotate(data_brick[,, i]))));     bba <- brick(bba, ccc); }
ls()
year_search<-c(1989,2001) years < as.numeric(as.character(years(as.Date(ncdata$dim[[3]]$vals, origin = '1900-01-01')))) ii <- which(years %in% year_search) data_brick <- data[,,ii]
year_search<-c(1989,2001) years <-as.numeric(as.character(years(as.Date(ncdata$dim[[3]]$vals, origin = '1900-01-01')))) ii <- which(years %in% year_search) data_brick <- data[,,ii] #fi
ii
length(ii)
bba<-raster(rotate(rotate(rotate(data_brick[,,1])))) for (i in 2:length(ii)) {     ccc <- raster(rotate(rotate(rotate(data_brick[,, i]))));     bba <- brick(bba, ccc); }
dim(data_brick)
ccc
bba
bba<-raster(rotate(rotate(rotate(data_brick[,,1])))) for (i in 2:length(ii)) {     ccc <- raster(rotate(rotate(rotate(data_brick[, ,i]))));     bba <- brick(bba, ccc); }
bba<-raster(rotate(rotate(rotate(data_brick[,,1])))) for (i in 2:length(ii)) {     ccc <- brick(rotate(rotate(rotate(data_brick[, ,i]))));     bba <- brick(bba, ccc); }
?stack
bba<-raster(rotate(rotate(rotate(data_brick[,,1])))) for (i in 2:length(ii)) {     ccc <- raster(rotate(rotate(rotate(data_brick[, ,i]))));     bba <- stack(bba, ccc); }
bba
plot(bba[[1]])
extent(bba)<-c(-90,90,-180,180)
bba
flst <- dir() ncdata <- nc_open(flst[1]); data <- ncvar_get(ncdata); year_search<-c(1989,2001) years <-as.numeric(as.character(years(as.Date(ncdata$dim[[3]]$vals, origin = '1900-01-01')))) ii <- which(years %in% year_search) data_brick <- data[,,ii] #firstly,rotate layers and build a brick then extract #extent(data_brick)<-c(-90,90,180,-180) bba<-raster(rotate(rotate(rotate(data_brick[,,1])))) for (i in 2:length(ii)) {     ccc <- raster(rotate(rotate(rotate(data_brick[, ,i]))));     bba <- stack(bba, ccc); } extent(bba)<-c(-90,90,-180,180)
bba<-raster(rotate(rotate(rotate(data_brick[,,1]))))
bba
extent(bba)<-c(-180,180,-90,90)
bba
bba <- raster(rotate(rotate(rotate(data[,, ii[1]])))) extent(bba) <- c(-180, 180, -90, 90,) for (i in 2:length(ii)) {     ccc <- raster(rotate(rotate(rotate(data[,, ii[i]]))));     extent(ccc) <- c(-180, 180, -90, 90,)     bba <- stack(bba, ccc); }
bba <- raster(rotate(rotate(rotate(data[,, ii[1]])))) extent(bba) <- c(-180, 180, -90, 90) for (i in 2:length(ii)) {     ccc <- raster(rotate(rotate(rotate(data[,, ii[i]]))));     extent(ccc) <- c(-180, 180, -90, 90)     bba <- stack(bba, ccc); } #ex
ii
bba
plot(bba[[1]])
plot(bba[[1]],ylim=c(-100,100))
data_cal<-extract(bba,data.frame(x=11,y=12))
data_cal
data_cal <- as.numeric(extract(bba, data.frame(x = 11, y = 12)))
data_cal
path1 <- "d://cru.ts//" lo_to_ex <- read.csv(paste(path1, "meta_info.csv"));
lo_to_ex
path1 <- "d://cru.ts//" lo_to_ex <- read.csv(paste(path1, "meta_info.csv",sep=''));
path1 <- "d://cru.ts//" lo_to_ex <- read.csv(paste(path1, "meta_info.csv",sep=''));
names(lo_to_ex)
library(ncdf4); library(raster); library(chron); library(readxl); path0 <- "d://cru.ts//nc" setwd(path0); flst <- dir() path1 <- "d://cru.ts//" lo_to_ex <- read.csv(paste(path1, "meta_info.csv",sep='')); i3 <- which(!is.na(lo_to_ex$lat)) lo_to_ex2 <-lo_to_ex[i3,] for (ijk in 1:length(flst)) {     ncdata <- nc_open(flst[ijk]);     data <- ncvar_get(ncdata);     years <- as.numeric(as.character(years(as.Date(ncdata$dim[[3]]$vals, origin = '1900-01-01'))))     for (ij in 1:length(lo_to_ex2$id)) {         year_search <- lo_to_ex2$year         ii <- which(years %in% year_search)         data_brick <- data[,, ii]         bba <- raster(rotate(rotate(rotate(data[,, ii[1]]))))         extent(bba) <- c(-180, 180, -90, 90)         for (i in 2:length(ii)) {             ccc <- raster(rotate(rotate(rotate(data[,, ii[i]]))));             extent(ccc) <- c(-180, 180, -90, 90)             bba <- stack(bba, ccc);         }         data_cal <- as.numeric(extract(bba, data.frame(x = lo_to_ex$lon[ij], y = lo_to_ex$lat[ij])))         print(summary(data_cal))     } }
library(ncdf4); library(raster); library(chron); rotate <- function(x) t(apply(x, 2, rev)) path0 <- "d://cru.ts//nc" setwd(path0); flst <- dir() path1 <- "d://cru.ts//" lo_to_ex <- read.csv(paste(path1, "meta_info.csv", sep = '')); i3 <- which(!is.na(lo_to_ex$lat)) lo_to_ex2 <- lo_to_ex[i3,] for (ijk in 1:length(flst)) {     ncdata <- nc_open(flst[ijk]);     data <- ncvar_get(ncdata);     years <- as.numeric(as.character(years(as.Date(ncdata$dim[[3]]$vals, origin = '1900-01-01'))))     for (ij in 1:length(lo_to_ex2$id)) {         year_search <- lo_to_ex2$year         ii <- which(years %in% year_search)         data_brick <- data[,, ii]         bba <- raster(rotate(rotate(rotate(data[,, ii[1]]))))         extent(bba) <- c(-180, 180, -90, 90)         for (i in 2:length(ii)) {             ccc <- raster(rotate(rotate(rotate(data[,, ii[i]]))));             extent(ccc) <- c(-180, 180, -90, 90)             bba <- stack(bba, ccc);         }         data_cal <- as.numeric(extract(bba, data.frame(x = lo_to_ex$lon[ij], y = lo_to_ex$lat[ij])))         print(summary(data_cal))     } }
flst
substr(flst[1],21,23)
substr(flst[1],22,25)
substr(flst[1],22,24)
substr(flst,22,24)
paste(substr(flst,22,24),c('_mean',"_sum"))
paste(substr(flst,22,24),c('_mean',"_sum"),separationplot='')
paste(substr(flst,22,24),c('_mean',"_sum"),sep='')
library(ncdf4); library(raster); library(chron); rotate <- function(x) t(apply(x, 2, rev)); path0 <- "d://cru.ts//nc"; setwd(path0); flst <- dir(); path1 <- "d://cru.ts//"; lo_to_ex <- read.csv(paste(path1, "meta_info.csv",sep='')); i3 <- which(!is.na(lo_to_ex$lat)); lo_to_ex2 <- lo_to_ex[i3,]; outp <- matrix(NA, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id)); names(outp) <- c("id", paste(substr(flst, 22, 24), c('_mean', "_sum"), sep = '')); outp$id <- lo_to_ex2$id; for (ijk in 1:length(flst)) {     ncdata <- nc_open(flst[ijk]);     data <- ncvar_get(ncdata);     years <- as.numeric(as.character(years(as.Date(ncdata$dim[[3]]$vals, origin = '1900-01-01'))))     for (ij in 1:length(lo_to_ex2$id)) {         year_search <- lo_to_ex2$year         ii <- which(years %in% year_search)         data_brick <- data[,, ii]         bba <- raster(rotate(rotate(rotate(data[,, ii[1]]))))         extent(bba) <- c(-180, 180, -90, 90)         for (i in 2:length(ii)) {             ccc <- raster(rotate(rotate(rotate(data[,, ii[i]]))));             extent(ccc) <- c(-180, 180, -90, 90)             bba <- stack(bba, ccc);         }         data_cal <- as.numeric(extract(bba, data.frame(x = lo_to_ex$lon[ij], y = lo_to_ex$lat[ij])))         outp[ij,c(2*ijk,2*ijk+1)]=c(mean(data_cal,na.rm=T),sum(data_cal,na.rm=T))     } }
summary(outp)
lo_to
lo_to_ex2
path1 <- "d://cru.ts//"; lo_to_ex <- read.csv(paste(path1, "meta_info.csv", sep = ''),colClasses = c("character","numeric","numeric")); i3 <- which(!is.na(lo_to_ex$lat)); lo_to_ex2 <- lo_to_ex[i3,]; outp <- matrix(NA, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id)); names(outp) <- c("id", paste(substr(flst, 22, 24), c('_mean', "_sum"), sep = '')); outp$id <- lo_to_ex2$id;
i3 <- which(!is.na(lo_to_ex$lat)); lo_to_ex2 <- lo_to_ex[i3,]; outp <- matrix(NA, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id));
outp
i3 <- which(!is.na(lo_to_ex$lat)); lo_to_ex2 <- lo_to_ex[i3,]; outp <- as.data.frame(matrix(NA, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id))); names(outp) <- c("id", paste(substr(flst, 22, 24), c('_mean', "_sum"), sep = '')); outp$id <- lo_to_ex2$id;
outp$id
library(ncdf4); library(raster); library(chron); rotate <- function(x) t(apply(x, 2, rev)); path0 <- "d://cru.ts//nc"; setwd(path0); flst <- dir(); path1 <- "d://cru.ts//"; lo_to_ex <- read.csv(paste(path1, "meta_info.csv", sep = ''),colClasses = c("character","numeric","numeric")); i3 <- which(!is.na(lo_to_ex$lat)); lo_to_ex2 <- lo_to_ex[i3,]; outp <- as.data.frame(matrix(NA, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id))); names(outp) <- c("id", paste(substr(flst, 22, 24), c('_mean', "_sum"), sep = '')); outp$id <- lo_to_ex2$id; for (ijk in 1:length(flst)) {     ncdata <- nc_open(flst[ijk]);     data <- ncvar_get(ncdata);     years <- as.numeric(as.character(years(as.Date(ncdata$dim[[3]]$vals, origin = '1900-01-01'))))     for (ij in 1:length(lo_to_ex2$id)) {         year_search <- lo_to_ex2$year         ii <- which(years %in% year_search)         data_brick <- data[,, ii]         bba <- raster(rotate(rotate(rotate(data[,, ii[1]]))))         extent(bba) <- c(-180, 180, -90, 90)         for (i in 2:length(ii)) {             ccc <- raster(rotate(rotate(rotate(data[,, ii[i]]))));             extent(ccc) <- c(-180, 180, -90, 90)             bba <- stack(bba, ccc);         }         data_cal <- as.numeric(extract(bba, data.frame(x = lo_to_ex$lon[ij], y = lo_to_ex$lat[ij])))         outp[ij,c(2*ijk,2*ijk+1)]=c(mean(data_cal,na.rm=T),sum(data_cal,na.rm=T))     } }
ijk
year
year_search
library(ncdf4); library(raster); library(chron); rotate <- function(x) t(apply(x, 2, rev)); path0 <- "d://cru.ts//nc"; setwd(path0); flst <- dir(); path1 <- "d://cru.ts//"; lo_to_ex <- read.csv(paste(path1, "meta_info.csv", sep = ''),colClasses = c("character","numeric","numeric")); i3 <- which(!is.na(lo_to_ex$lat)); lo_to_ex2 <- lo_to_ex[i3,]; outp <- as.data.frame(matrix(NA, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id))); names(outp) <- c("id", paste(substr(flst, 22, 24), c('_mean', "_sum"), sep = '')); outp$id <- lo_to_ex2$id; for (ijk in 1:length(flst)) {     ncdata <- nc_open(flst[ijk]);     data <- ncvar_get(ncdata);     years <- as.numeric(as.character(years(as.Date(ncdata$dim[[3]]$vals, origin = '1900-01-01'))))     for (ij in 1:length(lo_to_ex2$id)) {         year_search <- lo_to_ex2$year[ij]         ii <- which(years %in% year_search)         data_brick <- data[,, ii]         bba <- raster(rotate(rotate(rotate(data[,, ii[1]]))))         extent(bba) <- c(-180, 180, -90, 90)         for (i in 2:length(ii)) {             ccc <- raster(rotate(rotate(rotate(data[,, ii[i]]))));             extent(ccc) <- c(-180, 180, -90, 90)             bba <- stack(bba, ccc);         }         data_cal <- as.numeric(extract(bba, data.frame(x = lo_to_ex$lon[ij], y = lo_to_ex$lat[ij])))         outp[ij,c(2*ijk,2*ijk+1)]=c(mean(data_cal,na.rm=T),sum(data_cal,na.rm=T))     } }
year
year_search
ii
data_brick
bba
data_cal <- as.numeric(extract(bba, data.frame(x = lo_to_ex2$lon[ij], y = lo_to_ex2$lat[ij]))) )
        data_cal <- as.numeric(extract(bba, data.frame(x = lo_to_ex2$lon[ij], y = lo_to_ex2$lat[ij])))
bba
?extract
data_cal <- as.numeric(extract(bba, data.frame(lo_to_ex2$lon[ij], lo_to_ex2$lat[ij])))
data_cal <- as.numeric(extract(bba, c(lo_to_ex2$lon[ij], lo_to_ex2$lat[ij])))
data_cal <- as.numeric(extract(bba, c(lo_to_ex2$lon[ij], lo_to_ex2$lat[ij])))
ij
lo_to_ex2$lat[ij]
lo_to_ex2$lon[ij]
lo
lo_to_ex2
library(ncdf4); library(raster); library(chron); rotate <- function(x) t(apply(x, 2, rev)); path0 <- "d://cru.ts//nc"; setwd(path0); flst <- dir(); path1 <- "d://cru.ts//"; lo_to_ex <- read.csv(paste(path1, "meta_info.csv", sep = ''),colClasses = c("character","numeric","numeric","numeric")); i3 <- which(!is.na(lo_to_ex$lat)); lo_to_ex2 <- lo_to_ex[i3,]; outp <- as.data.frame(matrix(NA, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id))); names(outp) <- c("id", paste(substr(flst, 22, 24), c('_mean', "_sum"), sep = '')); outp$id <- lo_to_ex2$id; for (ijk in 1:length(flst)) {     ncdata <- nc_open(flst[ijk]);     data <- ncvar_get(ncdata);     years <- as.numeric(as.character(years(as.Date(ncdata$dim[[3]]$vals, origin = '1900-01-01'))))     for (ij in 1:length(lo_to_ex2$id)) {         year_search <- lo_to_ex2$year[ij]         ii <- which(years %in% year_search)         bba <- raster(rotate(rotate(rotate(data[,, ii[1]]))))         extent(bba) <- c(-180, 180, -90, 90)         for (i in 2:length(ii)) {             ccc <- raster(rotate(rotate(rotate(data[,, ii[i]]))));             extent(ccc) <- c(-180, 180, -90, 90)             bba <- stack(bba, ccc);         }         data_cal <- as.numeric(extract(bba, data.frame(x = lo_to_ex2$lon[ij], y = lo_to_ex2$lat[ij])))         outp[ij,c(2*ijk,2*ijk+1)]=c(mean(data_cal,na.rm=T),sum(data_cal,na.rm=T))     } }
data_cal
ij
ijk
c(mean(data_cal, na.rm = T), sum(data_cal, na.rm = T))
outp
flst
outp <- as.data.frame(matrix(NA, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id))); names(outp) <- c("id", paste(substr(flst, 22, 24), rep(c('_mean', "_sum"),length(flst)), sep = ''));
names(outp)
rep(c('_mean', "_sum"),length(flst))
length(flst)
paste(s) outp <- as.data.frame(matrix(NA, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id))); names(outp) <- c("id", paste(substr(flst, 22, 24), rep(c('_mean'), length(flst)), sep = ''),substr(flst, 22, 24), rep(c("_sum"), length(flst)), sep = '')); outp$id <- lo_to_ex2$id;
names(outp) <- c("id", paste(substr(flst, 22, 24), rep(c('_mean'), length(flst)), sep = ''), paste(substr(flst, 22, 24), rep(c("_sum"), length(flst)), sep = ''));
names(outp)
c("id", paste(substr(flst, 22, 24), rep(c('_mean'), length(flst)), sep = ''), paste(substr(flst, 22, 24), rep(c("_sum"), length(flst)), sep = ''));
c("id", paste(substr(flst, 22, 24), rep(c('_mean', "_sum"), length(flst)), sep = ''));
c("id", paste(rep(substr(flst, 22, 24), 2), rep(c('_mean', "_sum"), length(flst)), sep = ''));
rep(substr(flst, 22, 24), 2)
?rep
rep(substr(flst, 22, 24), each=2)
c("id", paste(rep(substr(flst, 22, 24), each = 2), rep(c('_mean', "_sum"), length(flst)), sep = ''));
outp <- as.data.frame(matrix(NA, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id))); names(outp) <- c("id", paste(rep(substr(flst, 22, 24),each=2), rep(c('_mean', "_sum"),length(flst)), sep = '')); outp$id <- lo_to_ex2$id;
summary(outp)
outp <- as.data.frame(matrix(NA, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id))); names(outp) <- c("id", paste(rep(substr(flst, 22, 24),each=2), rep(c('_mean', "_sum"),length(flst)), sep = '')); row.names(outp)<- lo_to_ex2$id;
summary(outp)
rm(outp)
c("id", paste(rep(substr(flst, 22, 24), each = 2), rep(c('_mean', "_sum"), length(flst)), sep = ''));
>  outp <- as.data.frame(matrix(NA, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id))); names(outp) <- c("id", paste(rep(substr(flst, 22, 24),each=2), rep(c('_mean', "_sum"),length(flst)), sep = '')); row.names(outp)<- lo_to_ex2$id;
outp <- as.data.frame(matrix(NA, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id))); names(outp) <- c("id", paste(rep(substr(flst, 22, 24),each=2), rep(c('_mean', "_sum"),length(flst)), sep = '')); row.names(outp)<- lo_to_ex2$id;
outp
class(outp)
summary(outp)
outp <- as.data.frame(matrix(0, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id))); names(outp) <- c("id", paste(rep(substr(flst, 22, 24),each=2), rep(c('_mean', "_sum"),length(flst)), sep = '')); row.names(outp)<- lo_to_ex2$id;
summary(outp)
outp$id <- lo_to_ex2$id;
summary(outp)
library(ncdf4); library(raster); library(chron); rotate <- function(x) t(apply(x, 2, rev)); path0 <- "d://cru.ts//nc"; setwd(path0); flst <- dir(); path1 <- "d://cru.ts//"; lo_to_ex <- read.csv(paste(path1, "meta_info.csv", sep = ''),colClasses = c("character","numeric","numeric","numeric")); i3 <- which(!is.na(lo_to_ex$lat)); lo_to_ex2 <- lo_to_ex[i3,]; outp <- as.data.frame(matrix(0, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id))); names(outp) <- c("id", paste(rep(substr(flst, 22, 24),each=2), rep(c('_mean', "_sum"),length(flst)), sep = '')); row.names(outp) <- lo_to_ex2$id; outp$id <- lo_to_ex2$id; for (ijk in 1:length(flst)) {     ncdata <- nc_open(flst[ijk]);     data <- ncvar_get(ncdata);     years <- as.numeric(as.character(years(as.Date(ncdata$dim[[3]]$vals, origin = '1900-01-01'))))     for (ij in 1:length(lo_to_ex2$id)) {         year_search <- lo_to_ex2$year[ij]         ii <- which(years %in% year_search)         bba <- raster(rotate(rotate(rotate(data[,, ii[1]]))))         extent(bba) <- c(-180, 180, -90, 90)         for (i in 2:length(ii)) {             ccc <- raster(rotate(rotate(rotate(data[,, ii[i]]))));             extent(ccc) <- c(-180, 180, -90, 90)             bba <- stack(bba, ccc);         }         data_cal <- as.numeric(extract(bba, data.frame(x = lo_to_ex2$lon[ij], y = lo_to_ex2$lat[ij])))         outp[ij,c(2*ijk,2*ijk+1)]=c(mean(data_cal,na.rm=T),sum(data_cal,na.rm=T))     } }
ij
2*ijk
2*ijk+1
outp[ij,c(2,3)]
outp[ij, c(2 * ijk, 2 * ijk + 1)] = c(mean(data_cal, na.rm = T), sum(data_cal, na.rm = T))
        year_search <- lo_to_ex2$year[ij]         ii <- which(years %in% year_search)         bba <- raster(rotate(rotate(rotate(data[,, ii[1]]))))         extent(bba) <- c(-180, 180, -90, 90)         for (i in 2:length(ii)) {             ccc <- raster(rotate(rotate(rotate(data[,, ii[i]]))));             extent(ccc) <- c(-180, 180, -90, 90)             bba <- stack(bba, ccc);         }         data_cal <- as.numeric(extract(bba, data.frame(x = lo_to_ex2$lon[ij], y = lo_to_ex2$lat[ij])))         outp[ij,c(2*ijk,2*ijk+1)]=c(mean(data_cal,na.rm=T),sum(data_cal,na.rm=T))
rm(data_cal)
        year_search <- lo_to_ex2$year[ij]         ii <- which(years %in% year_search)         bba <- raster(rotate(rotate(rotate(data[,, ii[1]]))))         extent(bba) <- c(-180, 180, -90, 90)         for (i in 2:length(ii)) {             ccc <- raster(rotate(rotate(rotate(data[,, ii[i]]))));             extent(ccc) <- c(-180, 180, -90, 90)             bba <- stack(bba, ccc);         }         data_cal <- as.numeric(extract(bba, data.frame(x = lo_to_ex2$lon[ij], y = lo_to_ex2$lat[ij])))         outp[ij,c(2*ijk,2*ijk+1)]=c(mean(data_cal,na.rm=T),sum(data_cal,na.rm=T))
data_c
data_cal
?extract
        data_cal <- as.numeric(extract(bba, data.frame(x = lo_to_ex2$lon[ij], y = lo_to_ex2$lat[ij])), method = 'bilinear')         outp[ij,c(2*ijk,2*ijk+1)]=c(mean(data_cal,na.rm=T),sum(data_cal,na.rm=T))
outp
data_cal
lo
lo_to_ex2$id[14]
source("D:/cru.ts/data_extr/data_extr/main.R", echo = TRUE, encoding = "GB18030")
source("D:/cru.ts/data_extr/data_extr/main.R", echo = TRUE, encoding = "GB18030")
?try
source("D:/cru.ts/data_extr/data_extr/main.R", echo = TRUE, encoding = "GB18030")
atry
source("D:/cru.ts/data_extr/data_extr/main.R", echo = TRUE, encoding = "GB18030")
source("D:/cru.ts/data_extr/data_extr/main.R", echo = TRUE, encoding = "gb2312")
?break
ij
data_cal
ijk
c(mean(data_cal, na.rm = T), sum(data_cal, na.rm = T))
        year_search <- lo_to_ex2$year[ij]         ii <- which(years %in% year_search)         bba <- raster(rotate(rotate(rotate(data[,, ii[1]]))))         extent(bba) <- c(-180, 180, -90, 90)         for (i in 2:length(ii)) {             ccc <- raster(rotate(rotate(rotate(data[,, ii[i]]))));             extent(ccc) <- c(-180, 180, -90, 90)             bba <- stack(bba, ccc);         }
ij
      year_search <- lo_to_ex2$year[ij]         ii <- which(years %in% year_search)
        bba <- raster(rotate(rotate(rotate(data[,, ii[1]]))))
        extent(bba) <- c(-180, 180, -90, 90)
            ccc <- raster(rotate(rotate(rotate(data[,, ii[i]]))));
            ccc <- raster(rotate(rotate(rotate(data[,, ii[i]]))));
ii
year_search
       for (ij in 1:length(lo_to_ex2$id)) {         year_search <- lo_to_ex2$year[ij]         ii <- which(years %in% year_search)         if(is.na(ii)) break;         bba <- raster(rotate(rotate(rotate(data[,, ii[1]]))))         extent(bba) <- c(-180, 180, -90, 90)         for (i in 2:length(ii)) {             ccc <- raster(rotate(rotate(rotate(data[,,ii[i]]))));             extent(ccc) <- c(-180, 180, -90, 90)             bba <- stack(bba, ccc);         }         data_cal <- as.numeric(extract(bba, data.frame(x = lo_to_ex2$lon[ij], y = lo_to_ex2$lat[ij])), method = 'bilinear')         if(is.na(mean(data_cal, na.rm = T))) break;         outp[ij, c(2 * ijk, 2 * ijk + 1)] = c(mean(data_cal, na.rm = T), sum(data_cal, na.rm = T))     }
i3 <- which((!is.na(lo_to_ex$lat))) & (lo_to_ex2$year<=2014));
i3 <- which((!is.na(lo_to_ex$lat))& (lo_to_ex2$year<=2014));
source("D:/cru.ts/data_extr/data_extr/main.R", echo = TRUE, encoding = "gb2312")
source("D:/cru.ts/data_extr/data_extr/main.R", echo = TRUE, encoding = "gb2312")
source("D:/cru.ts/data_extr/data_extr/main.R", echo = TRUE, encoding = "gb2312")
outp
source("D:/cru.ts/data_extr/data_extr/main.R", encoding = "gb2312")
source("D:/cru.ts/data_extr/data_extr/main.R", echo = TRUE, encoding = "gb2312")
outp
write.csv(outp,'outp.csv')
rnosie <- rnorm(1000)*10 r1 <- rnoise r1[] <- 0 po <- floor(rnorm(3) * 500) r1[po] <- 10 plot(rnoise) points(r1,col=2,type='b')
r1
rnoise
rnosie <- rnorm(1000)*10
r1 <- rnoise
norm(1000)
rno
?rnorm
rnoise <- rnorm(1000)*10 r1 <- rnoise r1[] <- 0 po <- floor(rnorm(3) * 500) r1[po] <- 10 plot(rnoise) points(r1,col=2,type='b')
plot(rnoise,pch='.') points(r1,col=2,type='b')
rnoise <- rnorm(1000)*10 r1 <- rnoise r1[] <- 0 po <- floor(rnorm(10) * 500) r1[po] <- 30 plot(rnoise,pch='.') points(r1,col=2,type='b')
r1
po
po <- abs(floor(rnorm(10) * 500)) r1[po] <- 30 plot(rnoise,pch='.') points(r1,col=2,type='b')
rnoise <- rnorm(1000)*10 r1 <- rnoise r1[] <- 0 po <- abs(floor(rnorm(5) * 500)) r1[po] <- 30 plot(rnoise,type='l') points(r1,col=2,type='b')
plot(rnoise,type='l',xlab='',axes=F) points(r1, col = 2, type = 'b')
plot(rnoise,type='l',xlab='',axes=F) points(r1, col = 2, type = 'b') box()
plot(rnoise,type='l',xlab='',axes=F,ylab='') points(r1, col = 2, type = 'b') box()
po <- abs(floor(rnorm(5) * 500)) r1[po] <- rnorm(po)*30 plot(rnoise,type='l',xlab='',axes=F,ylab='') points(r1, col = 2, type = 'b') box()
plot(rnoise,type='l',xlab='',axes=F,ylab='',col='grey') points(r1,lwd=2, col = 2, type = 'b') box()
plot(rnoise,type='l',xlab='',axes=F,ylab='',col='grey') points(r1, col = 2, type = 'b') box()
 rnoise <- rnorm(1000)*10 r1 <- rnoise r1[] <- 0 po <- abs(floor(rnorm(3) * 500)) r1[po] <- rnorm(po)*30 plot(rnoise,type='l',xlab='',axes=F,ylab='',col='grey') points(r1, col = 2, type = 'b') box()
rnoise <- rnorm(100)*10 r1 <- rnoise r1[] <- 0 po <- abs(floor(rnorm(5) * 500)) r1[po] <- rnorm(po)*30 plot(rnoise,type='l',xlab='',axes=F,ylab='',col='grey') points(r1, col = 2, type = 'b') box()
rnoise <- rnorm(100)*10 r1 <- rnoise r1[] <- 0 po <- abs(floor(rnorm(5) * 500)) r1[po] <- rnorm(po)*30 plot(rnoise,type='l',xlab='',axes=F,ylab='',col='grey') points(r1, col = 2, type = 'b') box()
rnoise <- rnorm(100)*10 r1 <- rnoise r1[] <- 0 po <- abs(floor(rnorm(5) * 500)) r1[po] <- rnorm(po)*30 plot(rnoise,type='l',xlab='',axes=F,ylab='',col='grey') points(r1, col = 2, type = 'b') box()
rnoise <- rnorm(100)*10 r1 <- rnoise r1[] <- 0 po <- abs(floor(rnorm(5) * 500)) r1[po] <- rnorm(po)*30 plot(rnoise,type='l',xlab='',axes=F,ylab='',col='grey') points(r1, col = 2, type = 'b') box()
rnoise <- rnorm(100)*10 r1 <- rnoise r1[] <- 0 po <- abs(floor(rnorm(5) * 500)) r1[po] <- rnorm(po)*30 plot(rnoise,type='l',xlab='',axes=F,ylab='',col='grey') points(r1, col = 2, type = 'b') box()
rnoise <- rnorm(100)*10 r1 <- rnoise r1[] <- 0 po <- abs(floor(rnorm(5) * 50)) r1[po] <- rnorm(po)*30 plot(rnoise,type='l',xlab='',axes=F,ylab='',col='grey') points(r1, col = 2, type = 'b') box()
library(mistral)
twodof
twodof(10)
twodof()
rnoise <- rnorm(100) * 10 rnoise<-sort(rnoise)*rnoise r1 <- rnoise r1[] <- 0 po <- abs(floor(rnorm(5) * 50)) r1[po] <- rnorm(po)*30 plot(rnoise,type='l',xlab='',axes=F,ylab='',col='grey') points(r1, col = 2, type = 'b') box()
rnoise <- rnorm(1000) * 10 rnoise<-sort(rnoise)*rnoise r1 <- rnoise r1[] <- 0 po <- abs(floor(rnorm(5) * 50)) r1[po] <- rnorm(po)*30 plot(rnoise,type='l',xlab='',axes=F,ylab='',col='grey') points(r1, col = 2, type = 'b') box()
plot(rnoise[1:500],type='l',xlab='',axes=F,ylab='',col='grey') points(r1, col = 2, type = 'b') box()
po <- abs(floor(rnorm(5) * 50)) r1[po] <- rnorm(po)*50 plot(rnoise[1:500],type='l',xlab='',axes=F,ylab='',col='grey') points(r1, col = 2, type = 'b') box()
po <- abs(floor(rnorm(5) * 50)) r1[po] <- rnorm(po)*500 plot(rnoise[1:500],type='l',xlab='',axes=F,ylab='',col='grey') points(r1, col = 2, type = 'b') box()
rnoise <- rnorm(1000) * 10 rnoise<-sort(rnoise)*rnoise r1 <- rnoise r1[] <- 0 po <- abs(floor(rnorm(5) * 50)) r1[po] <- rnorm(po)*500 plot(rnoise[1:500],type='l',xlab='',axes=F,ylab='',col='grey') points(r1, col = 2, type = 'b') box()
rnoise <- rnorm(1000) * 10 rnoise<-sort(rnoise)*rnoise r1 <- rnoise r1[] <- 0 po <- abs(floor(rnorm(5) * 50)) r1[po] <- rnorm(po)*500 plot(rnoise[1:500],type='l',xlab='',axes=F,ylab='',col='grey') points(r1, col = 2, type = 'l') box()
rnoise <- rnorm(1000) * 10 rnoise<-sort(rnoise)*rnoise r1 <- rnoise r1[] <- 0 po <- abs(floor(rnorm(5) * 50)) r1[po] <- rnorm(po)*max(rnoise) plot(rnoise[1:550],type='l',xlab='',axes=F,ylab='',col='grey') points(r1, col = 2, type = 'l') box()
 rnoise <- rnorm(1000) * 10 rnoise<-sort(rnoise)*rnoise r1 <- rnoise r1[] <- 0 po <- abs(floor(rnorm(6) * 50)) r1[po] <- rnorm(po)*max(rnoise) plot(rnoise[1:550],type='l',xlab='',axes=F,ylab='',col='grey') points(r1, col = 2, type = 'l') box()
rnoise <- rnorm(1000) * 10 rnoise<-sort(rnoise)*rnoise r1 <- rnoise r1[] <- 0 po <- abs(floor(rnorm(6) * 500)) r1[po] <- rnorm(po)*max(rnoise) plot(rnoise[1:550],type='l',xlab='',axes=F,ylab='',col='grey') points(r1, col = 2, type = 'l') box()
rnoise <- rnorm(1000) * 10 rnoise<-sort(rnoise)*rnoise r1 <- rnoise r1[] <- 0 po <- abs(floor(rnorm(6) * 500)) r1[po] <- rnorm(po)*max(rnoise)/2 plot(rnoise[1:550],type='l',xlab='',axes=F,ylab='',col='grey') points(r1, col = 2, type = 'l') box()
rnoise <- rnorm(1000) * 10 rnoise<-sort(rnoise)*rnoise r1 <- rnoise r1[] <- 0 po <- abs(floor(rnorm(6) * 500)) r1[po] <- rnorm(po)*max(rnoise)/2 plot(rnoise[1:550],type='l',xlab='',axes=F,ylab='',col='grey') points(r1, col = 2, type = 'l') box()
rnoise <- rnorm(1000) * 10 rnoise<-sort(rnoise)*rnoise r1 <- rnoise r1[] <- 0 po <- abs(floor(rnorm(6) * 500)) r1[po] <- rnorm(po)*max(rnoise) plot(rnoise[1:510],type='l',xlab='',axes=F,ylab='',col='grey') points(r1, col = 2, type = 'l') box()
for (iy in 1:3) {     for (im in 1:12) {         for (id in 1:10) {             i <- (iy - 1) * (im - 1) + (im - 1) * id + id         }     } }
i
for (iy in 1:3) {for (im in 1:12) {for (id in 1:10) { i <- (iy - 1) * (im - 1) + (im - 1) * id + id;print(i)}}}
l.id<-10 for (iy in 1:3) {for (im in 1:12) {for (id in 1:10) { i <- (iy - 1) * 12* l.id + (im-1)*l.id + id;print(i)}}}
for (ik in 1:3) { for (id in 1:10) { i <- (ik - 1) * l.id * 12 + (ij - 1) * 12; print(i) }}
for (ik in 1:3) { for (ij in 1:10) { i <- (ik - 1) * l.id * 12 + (ij - 1) * 12; print(i) }}
library(chron)
?years
Dt <- Sys.Date() ## Using the months method for Date objects. months(Dt)
Dt <- Sys.Date() ## Using the months method for Date objects. months(Dt, abbrivation = F     )
Dt <- Sys.Date() ## Using the months method for Date objects. as.numeric(months(Dt))
Dt
as.numeric(months(Dt))
as.numeric(months(Dt))
julian(1, 1, 1970) # [1] 0 unlist(month.day.year(0))
 # [1] 0 unlist(month.day.year(0))
month.day.year(ncdata$dim[[3]]$vals)
path0 <- "d://cru.ts//nc"; setwd(path0); flst <- dir();
ncdata <- nc_open(flst[ijk]); data <- ncvar_get(ncdata); nc_close(ncdata);
library(ncdf4)
ijk=1
ncdata <- nc_open(flst[ijk]); data <- ncvar_get(ncdata); nc_close(ncdata);
month
month.day.year(ncdata$dim[[3]]$vals)
month.day.year(ncdata$dim[[3]]$vals,origin='1900-01-01')
month.day.year(ncdata$dim[[3]]$vals,origin=c(month=1,day=1,year=1900))
month.day.year(ncdata$dim[[3]]$vals,origin=c(month=1,day=1,year=1900))->mdy
mdy$month
lo_to_ex$id
path1 <- "d://cru.ts//"; lo_to_ex <- read.csv(paste(path1, "id_station.csv", sep = ''), colClasses = c("character", "character", "numeric", "numeric"));
lo_to_ex$id
ss <- stack(flst[1]) ex_ss <- extract(ss, lo_to_ex[, c('lon', 'lat')])
library(raster);
ss <- stack(flst[1]) ex_ss <- extract(ss, lo_to_ex[, c('lon', 'lat')])
dim（ex_ss)
dim(ex_ss)
ex_ss <- t(ex_ss) ex_ss <- data.frame(id = lo_to_ex$id, years, month, ex_ss)
ijk=1 ncdata <- nc_open(flst[ijk]); data <- ncvar_get(ncdata); nc_close(ncdata); mdy<-month.day.year(ncdata$dim[[3]]$vals, origin = c(month = 1, day = 1, year = 1900)) years <- mdy$year months <- mdy$month ss <- stack(flst[1]) ex_ss <- extract(ss, lo_to_ex[, c('lon', 'lat')]) ex_ss <- t(ex_ss) ex_ss <- data.frame(id = lo_to_ex$id, years, months, ex_ss)
dim(lo_to_ex)
length(years)
names(ex_ss)
ss <- stack(flst[1]) ex_ss <- extract(ss, lo_to_ex[, c('lon', 'lat')]) ex_ss <- t(ex_ss)
dim(ex_ss)
names(ex_ss)<-lo_to_ex$id
names(ex_ss)
names(t(ex_ss))
ss <- stack(flst[1]) ex_ss <- extract(ss, lo_to_ex[, c('lon', 'lat')]) ex_ss <- t(ex_ss) names(ex_ss) <- lo_to_ex$id ex_ss <- data.frame(years, months, ex_ss)
names(ex_ss)
paste('S',lo_to_ex$id)
paste('S',lo_to_ex$id,separationplot='')
paste('S',lo_to_ex$id,sep='')
ss <- stack(flst[1]) ex_ss <- extract(ss, lo_to_ex[, c('lon', 'lat')]) ex_ss <- t(ex_ss) names(ex_ss) <- paste('S', lo_to_ex$id, sep = '') ex_ss <- data.frame(years, months, ex_ss)
names(ex_ss)
class(ex_ss)
ss <- stack(flst[1]) ex_ss <- extract(ss, lo_to_ex[, c('lon', 'lat')]) ex_ss <- as.data.frame(t(ex_ss)) names(ex_ss) <- paste('S', lo_to_ex$id, sep = '') ex_ss <- data.frame(years, months, ex_ss)
names(ex_ss)
?reshape
reshape(ex_ss,direction='long')
reshape(ex_ss,direction='long',varying = )
ss <- stack(flst[1]) ex_ss <- extract(ss, lo_to_ex[, c('lon', 'lat')]) ex_ss <- as.data.frame(t(ex_ss)) nss<-paste('S', lo_to_ex$id, sep = '') names(ex_ss) <- nss ex_ss <- data.frame(years, months, ex_ss) reshape(ex_ss,varying=nss,direction='long')
dim(ex_ss)
reshape(ex_ss, varying = 4:48, direction = 'long')
stack(ex_ss)
?stck
?sstck
?stack
reshape(ex_ss, varying = 4:48, direction = 'long')
names(ex_ss)
reshape(ex_ss,idvar = c("years","months"), direction = 'long')
reshape(ex_ss, v.names = c("NPP"), varying = names(ex_ss)[4:48], direction = 'long')
reshape(ex_ss, v.names = c("NPP"), varying = names(ex_ss)[4:48], direction = 'long')->aa
aa[1:100,]
reshape(ex_ss, v.names = c("NPP"), varying = names(ex_ss)[4:48], timevar = "Cls_C", time = names(ex_ss)[4:48], direction = 'long')->aa
names(aa)
aa[1:10,]
aa[1:100,]
aa[1:100,]
ex_ss[1:100,]
reshape(ex_ss, v.names = c("NPP"), varying = names(ex_ss)[3:48], timevar = "Cls_C", time = names(ex_ss)[3:48], direction = 'long')->aa
ex_ss[1:100,]
aa[1:100,]
reshape(ex_ss, v.names = substr(flst[ijk], 22, 24), varying = names(ex_ss)[3:48], timevar = "id", time = names(ex_ss)[3:48], direction = 'long') -> aa
ss <- stack(flst[1]) ex_ss <- extract(ss, lo_to_ex[, c('lon', 'lat')]) ex_ss <- as.data.frame(t(ex_ss)) nss<-paste('S', lo_to_ex$id, sep = '') names(ex_ss) <- nss ex_ss <- data.frame(years, months, ex_ss) reshape(ex_ss, v.names = substr(flst[ijk], 22, 24), varying = names(ex_ss)[3:48], timevar = "id", time = names(ex_ss)[3:48], direction = 'long') -> aa
reshape(ex_ss, v.names = substr(flst[ijk], 22, 24), varying = names(ex_ss)[3:48], timevar = "id1", time = names(ex_ss)[3:48], direction = 'long') -> aa
?reshape2
names(aa)
library(ncdf4); library(raster); library(chron); library(doBy); path0 <- "d://cru.ts//nc"; setwd(path0); flst <- dir(); path1 <- "d://cru.ts//"; lo_to_ex <- read.csv(paste(path1, "id_station.csv", sep = ''), colClasses = c("character", "character", "numeric", "numeric")); ijk = 1 ncdata <- nc_open(flst[ijk]); data <- ncvar_get(ncdata); nc_close(ncdata); mdy<-month.day.year(ncdata$dim[[3]]$vals, origin = c(month = 1, day = 1, year = 1900)) years <- mdy$year months <- mdy$month ss <- stack(flst[1]) ex_ss <- extract(ss, lo_to_ex[, c('lon', 'lat')]) ex_ss <- as.data.frame(t(ex_ss)) nss<-paste('S', lo_to_ex$id, sep = '') names(ex_ss) <- nss ex_ss <- data.frame(years, months, ex_ss) reshape(ex_ss, v.names = substr(flst[ijk], 22, 24), varying = names(ex_ss)[3:48], timevar = "id1", time = names(ex_ss)[3:48], direction = 'long') -> aa ijk = 2 ncdata <- nc_open(flst[ijk]); data <- ncvar_get(ncdata); nc_close(ncdata); mdy <- month.day.year(ncdata$dim[[3]]$vals, origin = c(month = 1, day = 1, year = 1900)) years <- mdy$year months <- mdy$month ss <- stack(flst[1]) ex_ss <- extract(ss, lo_to_ex[, c('lon', 'lat')]) ex_ss <- as.data.frame(t(ex_ss)) nss <- paste('S', lo_to_ex$id, sep = '') names(ex_ss) <- nss ex_ss <- data.frame(years, months, ex_ss) reshape(ex_ss, v.names = substr(flst[ijk], 22, 24), varying = names(ex_ss)[3:48], timevar = "id1", time = names(ex_ss)[3:48], direction = 'long') -> bb
dim(aa)
dim(bb)
names(aa)
names(bb)
aa$id<-paste(aa$id1,aa$years,aa$months,separationplot='.')
aa$id[1:100]
aa$id<-paste(aa$id1,aa$years,aa$months,sep='.')
aa$id[1:100]
bb$id <- paste(bb$id1, bb$years, bb$months, sep = '.')
names(bb)
merge(aa,bb,by='id')->cc
dim(cc)
names(cc)
cc<-cc[,c(1:5,9)]
names(cc)
names(cc)
names(cc) <- c("id", "years", "months", "id1", "pre", "tem")
names(cc)
cc[1,]
flst
cc[1:100,]
rm(list=ls())
source("D:/cru.ts/data_extr/data_extr/jiang-cru.R", echo = TRUE, encoding = "gb2312")
source("D:/cru.ts/data_extr/data_extr/jiang-cru.R", echo = TRUE, encoding = "gb2312")
cc[1:100,]
plot(cc$tem)
plot(cc$pre)
require(doBy)
summaryBy(pre~id1+year,fun=sum)
summaryBy(pre~id1+year,fun=sum,data=ccc)
summaryBy(pre~id1+year,fun=sum,data=cc)
plot(summaryBy(pre~id1+year,fun=sum,data=cc))
ss<-summaryBy(pre~id1+year,fun=sum,data=cc)
names(ss)
plot(ss)
plot(ss)
names(ss)
names(cc)
ss<-summaryBy(pre~id1+years,FUN=sum,data=cc)
names(ss)
plot(ss)
plot(ss[,2:3])
ss<-summaryBy(tem~id1+years,FUN=mean,data=cc)
plot(ss[,2:3])
write.csv(cc,'tem_pre.csv',row.names=F)
path0 <- "d://cru.ts//"; setwd(path0); read.csv('s2016.csv') -> obs read.csv('tem_pre.csv') -> cru merge(obs, cru, by = 'id') -> all
dim(all)
dim(obs)
names(all)
?extract
lo_to_ex$id
as.factor(obs$id1)
names(all)
plot(all$pre_cru~all$pre_obs)
lm(all$pre_cru~all$pre_obs)
lm(all$tem_cru~all$tem_obs)
names(all)
source("D:/cru.ts/data_extr/data_extr/jiang-cru.R", echo = TRUE, encoding = "gb2312")
dim(all)
dim(cc)
dim(lo_to_ex)
124*12*2014
range(years)
2014-1901
114*12*124
dim(ex_ss)
1368*124
names(ex_ss)
dim(ex_ss)
ncol(ex_ss)
library(ncdf4); library(raster); library(chron); library(doBy); path0 <- "d://cru.ts//nc"; setwd(path0); flst <- dir(); path1 <- "d://cru.ts//"; #lo_to_ex <- read.csv(paste(path1, "id_station.csv", sep = ''), colClasses = c("character", "character", "numeric", "numeric")); lo_to_ex <- read.csv(paste(path1, "id_station_ne.csv", sep = ''), colClasses = c("character", "character", "numeric", "numeric")); ijk = 1 ncdata <- nc_open(flst[ijk]); data <- ncvar_get(ncdata); nc_close(ncdata); mdy<-month.day.year(ncdata$dim[[3]]$vals, origin = c(month = 1, day = 1, year = 1900)) years <- mdy$year months <- mdy$month ss <- stack(flst[ijk]) ex_ss <- extract(ss, lo_to_ex[, c('lon', 'lat')], method = 'bilinear') ex_ss <- as.data.frame(t(ex_ss)) nss<-paste('S', lo_to_ex$id, sep = '') names(ex_ss) <- nss ex_ss <- data.frame(years, months, ex_ss) reshape(ex_ss, v.names = substr(flst[ijk], 22, 24), varying = names(ex_ss)[3:ncol(ex_ss)], timevar = "id1", time = names(ex_ss)[3:ncol(ex_ss)], direction = 'long') -> aa aa$id<-paste(aa$id1,aa$years,aa$months,sep='.') ijk = 2 ncdata <- nc_open(flst[ijk]); data <- ncvar_get(ncdata); nc_close(ncdata); mdy <- month.day.year(ncdata$dim[[3]]$vals, origin = c(month = 1, day = 1, year = 1900)) years <- mdy$year months <- mdy$month ss <- stack(flst[ijk]) ex_ss <- extract(ss, lo_to_ex[, c('lon', 'lat')], method = 'bilinear') ex_ss <- as.data.frame(t(ex_ss)) nss <- paste('S', lo_to_ex$id, sep = '') names(ex_ss) <- nss ex_ss <- data.frame(years, months, ex_ss) reshape(ex_ss, v.names = substr(flst[ijk], 22, 24), varying = names(ex_ss)[3:ncol(ex_ss)], timevar = "id1", time = names(ex_ss)[3:ncol(ex_ss)], direction = 'long') -> bb bb$id <- paste(bb$id1, bb$years, bb$months, sep = '.') merge(aa, bb, by = 'id') -> cc cc <- cc[, c(1:5, 9)]; names(cc) <- c("id", "years", "months", "id1", "pre", "tem") #write.csv(cc, 'tem_pre.csv', row.names = F) write.csv(cc, 'tem_pre_ne.csv', row.names = F)
dim(cc)
names(cc)
path0 <- "d://cru.ts//"; setwd(path0); read.csv('s2016obs_ne.csv') -> obs read.csv('tem_pre_cru_ne.csv') -> cru merge(obs, cru, by = 'id') -> all all <- all[, c(1:6, 10:11)] names(all) <- c("id", "month", "id1", "years", "tem_obs", "pre_obs", "pre_cru", "tem_cru") read.csv('id_station.csv') -> st_intl read.csv('id_station_ne.csv') -> st_ne ii <- which(!(st_ne$id1 %in% st_intl$id1)) id_stc<-st_ne$id1[ii,] ii_nintl <- which(all$id1 %in% id_stc$id1) ii_intl <- which(all$id1 %in% id_intl$id1) plot(all$tem_cru[ii_nintl], all$tem_obs[ii_nintl])
length(ii_nintl)
summary(st_ne$id1)
names(st_ne)
ii <- which(!(st_ne$id %in% st_intl$id)) id_stc<-st_ne$id[ii,] ii_nintl <- which(all$id1 %in% id_stc) ii_intl <- which(all$id1 %in% st_intl$id)
ii <- which(!(st_ne$id %in% st_intl$id)) id_stc<-st_ne$id[ii] ii_nintl <- which(all$id1 %in% id_stc) ii_intl <- which(all$id1 %in% st_intl$id)
plot(all$tem_cru[ii_nintl], all$tem_obs[ii_nintl])
plot(all$pre_cru[ii_nintl], all$pre_obs[ii_nintl])
plot(all$tem_cru[ii_intl], all$tem_obs[ii_intl])
plot(all$pre_cru[ii_intl], all$pre_obs[ii_intl])
lm(tem_cru~tem_obs,data=all[ii_nintl,])
lm(tem_obs~tem_cru,data=all[ii_nintl,])
lm(tem_obs ~ tem_cru, data = all[ii_intl,])
lm(pre_obs ~ pre_cru, data = all[ii_nintl,])
lm(pre_obs ~ pre_cru, data = all[ii_intl,])
lm(pre_cru ~ pre_obs, data = all[ii_nintl,])
lm(pre_cru ~ pre_obs, data = all[ii_intl,])
summary(lm(pre_cru ~ pre_obs, data = all[ii_nintl,])) summary(lm(pre_cru ~ pre_obs, data = all[ii_intl,]))
summary(lm(tem_obs ~ tem_cru, data = all[ii_nintl,])) summary(lm(tem_obs ~ tem_cru, data = all[ii_intl,]))
summary(lm(pre_cru ~ pre_obs, data = all[ii_nintl,])) summary(lm(pre_cru ~ pre_obs, data = all[ii_intl,]))
names(all)
library(doBy) summaryBy(tem_obs + tem_cru + pre_cru + pre_obs ~ years + months, FUN = mean, na.rm = T, data = all[ii_intl,])
s_intl <- summaryBy(tem_obs + tem_cru + pre_cru + pre_obs ~ years + months, FUN = mean, na.rm = T, data = all[ii_intl,]) s_nintl <- summaryBy(tem_obs + tem_cru + pre_cru + pre_obs ~ years + months, FUN = mean, na.rm = T, data = all[ii_nintl,])
ts.plot(s_intl)
plot.ts(s_intl)
names(s_intl)
ts.plot(s_intl[,2:3])
ts.plot(s_intl[,4:5])
plot(s_intl[,4:5])
plot(s_intl[,4])
plot(s_intl[,4],type='b')
points(s_intl[,5],type='b',col=2)
plot(s_nintl[,4],type='b')
points(s_nintl[,5],type='b',col=2)
