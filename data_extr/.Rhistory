library(ncdf4)
library(raster)
?extract
path0<-"d://cru.ts//nc" flst <- dir()
flst
path0 <- "d://cru.ts//nc" setwd(path0) flst <- dir()
flst
filen
filename(flst)
?filename(flst)
basen
basename(flst)
nc_readef(flst[1])
nc_readef(flst[1])
nc_re
nc_redef(flst[1])
a<-nc_open(flst[1])
nc_redef(a)
?nc_open
nc_close(a)
a<-nc_open(flst[1])
data<-ncvar_get(a)
summary(data)
data$var
data$var
dim(data)
1368/12
plot(data)
library(ncdf4); library(raster);
path0 <- "d://cru.ts//nc" setwd(path0) flst <- dir() ncdata <- nc_open(flst[1]); data <- ncatt_get(ncdata);
summary(ncdata)
ncdata$dim
ncdata$format
ncdata$lat
ncdata$long
ncdata$lon
380-365
library(chron)
jul
julian('1901-01-01')
Julian('1901-01-01')
?julian
Julian(asDate('1901-01-01'))
julian(asDate('1901-01-01'))
julian(as.Date('1901-01-01'))
julian(as.Date('1901-01-01'))
julian(as.Date('1901-01-01',origin='1900-01-01'))
julian(as.Date('1901-01-01',origin='1900-01-01'))
julian(as.Date(380,origin='1900-01-01'))
as.Date(380,origin='1900-01-01')
as.Date(410,origin='1900-01-01')
as.Date(410,origin='1900-01-01')
as.Date(410,origin='1900-01-01')
ncdata
ncdata$time
ncdata$year
as.Date(439,origin='1900-01-01')
summary(ncdata)
ncdata$dim
?nc_get
?nc_
?nc_close
ncdata$varid
summary(ncdata)
ncdata$var
summary(ncdata)
ncdata$natts
ncdata$dim
ncdata$var
ncdata <- nc_open(flst[1]); data.att <- ncatt_get(ncdata); data<-ncvar_get(ncdata)
data<-ncvar_get(ncdata)
dim(data)
plot(data[,,1])
plot(data[,,1])
class(data)
plot(data[,,1],xlim=c(0,100),yim=c(0,100))
plot(data[,,1],xlim=c(0,100),ylim=c(0,100))
summary(data)
summary(data[,,1])
spplot(data[,,1])
spplot(raster(data[,,1]))
aa<-(raster(data[,,1]))
aa
aa<-(raster(data[,,1:12]))
aa<-(rasterstack(data[,,1:12]))
aa<-(rasterbrick(data[,,1:12]))
?raster
extent(aa)
extent(aa)<-c(-90,90,-180,180)
aa
extent(aa)<-c(-180,180,-90,90)
aa
extent(aa)<-c(-90,90,-180,180)
aa
data[1,1,1:12]
data[1,1:10,1:12]
data[1:10,1:10,1]
?rotate
rotate(aa)
dim(aa)
raster(aa)->bb
rotate(bb)
flip(aa)
flip(aa,2)
flip(aa,1)
rotate(aa,1)
?extract
plot(aa)
extract(aa,data.frame(160,65))
aa
aa<-raster(t(data[,,1]))
plot(aa)
aa<-raster(t(t(data[,,1])))
plot(aa)
aa<-raster(t(t(t(data[,,1]))))
plot(aa)
aa<-raster((t(t(data[,,1]))))
plot(aa)
plot(rotate(aa))
rotate <- function(x) t(apply(x, 2, rev))
plot(raster(rotate(data[,,1])))
plot(raster(rotate(rotate(data[,,1]))))
plot(raster(rotate(rotate(rotate(data[,,1])))))
aa<-(raster(rotate(rotate(rotate(data[,,1])))))
aa
extent(aa)<-c(-180,180,-90,90)
aa
plot(aa,xlim=c(-90,90),ylim=c(-180,180))
plot(aa,xlim=c(-180,180),ylim=c(-90,90))
plot(aa,xlim=c(-180,180),ylim=c(-90,90))
aa
data.att$time
data.att$var
data.att
data.att
ls()
data.att <- ncatt_get(ncdata);
data.att <- ncatt_get(ncdata,1);
data.att <- ncatt_get(ncdata,0);
data.att
ncdata$time
ncdata
summary(ncdata)
summary(ncdata)
ncdata$dim
ncdata$dim[[3]]
ncdata$dim[[3]]$vals
as.Date(ncdata$dim[[3]]$vals)
as.Date(ncdata$dim[[3]]$vals,origin='1900-01-01')
year(as.Date(ncdata$dim[[3]]$vals,origin='1900-01-01'))
years(as.Date(ncdata$dim[[3]]$vals,origin='1900-01-01'))
as.numeric(years(as.Date(ncdata$dim[[3]]$vals,origin='1900-01-01')))
(years(as.Date(ncdata$dim[[3]]$vals,origin='1900-01-01')))
as.character(years(as.Date(ncdata$dim[[3]]$vals,origin='1900-01-01')))
as.numeric(as.character(years(as.Date(ncdata$dim[[3]]$vals,origin='1900-01-01'))))
?stcak
?stack
brick(data[,,1:12])
roatate(brick(data[,,1:12]))
rotate(brick(data[,,1:12]))
brick(aa)
brick(aa)->aa1
brick(aa,aa1)->aa1
brick(aa,aa1)->aa1
aa1
plot(aa)
plot(data[,,1])
plot(raster(data[,,1]))
aa<-(raster(data[,,1]))
extent(aa)<-c(-180,180,-90,90)
plot(aa)
extent(aa)<-c(-90,90,-180,180)
plot(aa)
baa<-brick(data[,,1:12])
extent(baa)<-c(-90,90,-180,180)
plot(baa)
plot(baa[1])
plot(baa[[1]])
baa
extract(baa,c(75,25))
extract(baa,data.frame(c(75,25)))
extract(baa,data.frame(c(75,25)))
?extract
?extract
baa
extent(baa)<-c(-90,90,180,-180)
baa
plot(baa[1])
plot(baa[[1]])
plot(baa[[1]])
plot(baa[[1]])
data_brick <- brick(data[,, ii])
data_brick <- brick(data[,, 1:12])
plot(data_brick[[1]])
aa <- (raster(rotate(rotate(rotate(data[,,1])))))
aa
plot(aa)
extent(aa)<-c(-180,180,-90,90)
plot(aa)
baa[[1]]
ls()
data_brick[[1]]
rotate(data_brick[[1]])
data_brick<-data[,,1:12]
bba<-brick(rotate(rotate(rotate(data_brick[[1]]))))
bba<-brick(rotate(rotate(rotate(data_brick[,,1]))))
data_brick <- data[,,ii]
data_brick <- data[,,1:12]
bba<-brick(rotate(rotate(rotate(data_brick[,,1]))))
bba<-(rotate(rotate(rotate(data_brick[,,1]))))
bba<-(rotate(rotate(rotate(data_brick[,,1])))) for (i in 2:length(ii)) {     bba <- brick(bba, (rotate(rotate(rotate(data_brick[,, 1]))))) }
ii=1:12
bba<-(rotate(rotate(rotate(data_brick[,,1])))) for (i in 2:length(ii)) {     bba <- brick(bba, (rotate(rotate(rotate(data_brick[,, 1]))))) }
bba<-(rotate(rotate(rotate(data_brick[,,1])))) for (i in 2:length(ii)) {     bba <- brick(bba, raster(rotate(rotate(rotate(data_brick[,, 1]))))) }
bba<-rotate(rotate(rotate(data_brick[,,1]))) for (i in 2:length(ii)) {     ccc <- raster(rotate(rotate(rotate(data_brick[,, 1]))))     bba <- brick(bba, ccc) }
bba<-rotate(rotate(rotate(data_brick[,,1]))) for (i in 2:length(ii)) {     ccc <- raster(rotate(rotate(rotate(data_brick[,,i]))))     bba <- brick(bba, ccc) }
bba<-rotate(rotate(rotate(data_brick[,,1]))) for (i in 2:length(ii)) {     ccc <- raster(rotate(rotate(rotate(data_brick[,,i]))))     #bba <- brick(bba, ccc) }
bba
rm(bba)
bba<-brick(rotate(rotate(rotate(data_brick[,,1])))) for (i in 2:length(ii)) {     ccc <- raster(rotate(rotate(rotate(data_brick[,, i]))));     bba <- brick(bba, ccc); }
bba<-raster(rotate(rotate(rotate(data_brick[,,1])))) for (i in 2:length(ii)) {     ccc <- raster(rotate(rotate(rotate(data_brick[,, i]))));     bba <- brick(bba, ccc); }
ls()
year_search<-c(1989,2001) years < as.numeric(as.character(years(as.Date(ncdata$dim[[3]]$vals, origin = '1900-01-01')))) ii <- which(years %in% year_search) data_brick <- data[,,ii]
year_search<-c(1989,2001) years <-as.numeric(as.character(years(as.Date(ncdata$dim[[3]]$vals, origin = '1900-01-01')))) ii <- which(years %in% year_search) data_brick <- data[,,ii] #fi
ii
length(ii)
bba<-raster(rotate(rotate(rotate(data_brick[,,1])))) for (i in 2:length(ii)) {     ccc <- raster(rotate(rotate(rotate(data_brick[,, i]))));     bba <- brick(bba, ccc); }
dim(data_brick)
ccc
bba
bba<-raster(rotate(rotate(rotate(data_brick[,,1])))) for (i in 2:length(ii)) {     ccc <- raster(rotate(rotate(rotate(data_brick[, ,i]))));     bba <- brick(bba, ccc); }
bba<-raster(rotate(rotate(rotate(data_brick[,,1])))) for (i in 2:length(ii)) {     ccc <- brick(rotate(rotate(rotate(data_brick[, ,i]))));     bba <- brick(bba, ccc); }
?stack
bba<-raster(rotate(rotate(rotate(data_brick[,,1])))) for (i in 2:length(ii)) {     ccc <- raster(rotate(rotate(rotate(data_brick[, ,i]))));     bba <- stack(bba, ccc); }
bba
plot(bba[[1]])
extent(bba)<-c(-90,90,-180,180)
bba
flst <- dir() ncdata <- nc_open(flst[1]); data <- ncvar_get(ncdata); year_search<-c(1989,2001) years <-as.numeric(as.character(years(as.Date(ncdata$dim[[3]]$vals, origin = '1900-01-01')))) ii <- which(years %in% year_search) data_brick <- data[,,ii] #firstly,rotate layers and build a brick then extract #extent(data_brick)<-c(-90,90,180,-180) bba<-raster(rotate(rotate(rotate(data_brick[,,1])))) for (i in 2:length(ii)) {     ccc <- raster(rotate(rotate(rotate(data_brick[, ,i]))));     bba <- stack(bba, ccc); } extent(bba)<-c(-90,90,-180,180)
bba<-raster(rotate(rotate(rotate(data_brick[,,1]))))
bba
extent(bba)<-c(-180,180,-90,90)
bba
bba <- raster(rotate(rotate(rotate(data[,, ii[1]])))) extent(bba) <- c(-180, 180, -90, 90,) for (i in 2:length(ii)) {     ccc <- raster(rotate(rotate(rotate(data[,, ii[i]]))));     extent(ccc) <- c(-180, 180, -90, 90,)     bba <- stack(bba, ccc); }
bba <- raster(rotate(rotate(rotate(data[,, ii[1]])))) extent(bba) <- c(-180, 180, -90, 90) for (i in 2:length(ii)) {     ccc <- raster(rotate(rotate(rotate(data[,, ii[i]]))));     extent(ccc) <- c(-180, 180, -90, 90)     bba <- stack(bba, ccc); } #ex
ii
bba
plot(bba[[1]])
plot(bba[[1]],ylim=c(-100,100))
data_cal<-extract(bba,data.frame(x=11,y=12))
data_cal
data_cal <- as.numeric(extract(bba, data.frame(x = 11, y = 12)))
data_cal
path1 <- "d://cru.ts//" lo_to_ex <- read.csv(paste(path1, "meta_info.csv"));
lo_to_ex
path1 <- "d://cru.ts//" lo_to_ex <- read.csv(paste(path1, "meta_info.csv",sep=''));
path1 <- "d://cru.ts//" lo_to_ex <- read.csv(paste(path1, "meta_info.csv",sep=''));
names(lo_to_ex)
library(ncdf4); library(raster); library(chron); library(readxl); path0 <- "d://cru.ts//nc" setwd(path0); flst <- dir() path1 <- "d://cru.ts//" lo_to_ex <- read.csv(paste(path1, "meta_info.csv",sep='')); i3 <- which(!is.na(lo_to_ex$lat)) lo_to_ex2 <-lo_to_ex[i3,] for (ijk in 1:length(flst)) {     ncdata <- nc_open(flst[ijk]);     data <- ncvar_get(ncdata);     years <- as.numeric(as.character(years(as.Date(ncdata$dim[[3]]$vals, origin = '1900-01-01'))))     for (ij in 1:length(lo_to_ex2$id)) {         year_search <- lo_to_ex2$year         ii <- which(years %in% year_search)         data_brick <- data[,, ii]         bba <- raster(rotate(rotate(rotate(data[,, ii[1]]))))         extent(bba) <- c(-180, 180, -90, 90)         for (i in 2:length(ii)) {             ccc <- raster(rotate(rotate(rotate(data[,, ii[i]]))));             extent(ccc) <- c(-180, 180, -90, 90)             bba <- stack(bba, ccc);         }         data_cal <- as.numeric(extract(bba, data.frame(x = lo_to_ex$lon[ij], y = lo_to_ex$lat[ij])))         print(summary(data_cal))     } }
library(ncdf4); library(raster); library(chron); rotate <- function(x) t(apply(x, 2, rev)) path0 <- "d://cru.ts//nc" setwd(path0); flst <- dir() path1 <- "d://cru.ts//" lo_to_ex <- read.csv(paste(path1, "meta_info.csv", sep = '')); i3 <- which(!is.na(lo_to_ex$lat)) lo_to_ex2 <- lo_to_ex[i3,] for (ijk in 1:length(flst)) {     ncdata <- nc_open(flst[ijk]);     data <- ncvar_get(ncdata);     years <- as.numeric(as.character(years(as.Date(ncdata$dim[[3]]$vals, origin = '1900-01-01'))))     for (ij in 1:length(lo_to_ex2$id)) {         year_search <- lo_to_ex2$year         ii <- which(years %in% year_search)         data_brick <- data[,, ii]         bba <- raster(rotate(rotate(rotate(data[,, ii[1]]))))         extent(bba) <- c(-180, 180, -90, 90)         for (i in 2:length(ii)) {             ccc <- raster(rotate(rotate(rotate(data[,, ii[i]]))));             extent(ccc) <- c(-180, 180, -90, 90)             bba <- stack(bba, ccc);         }         data_cal <- as.numeric(extract(bba, data.frame(x = lo_to_ex$lon[ij], y = lo_to_ex$lat[ij])))         print(summary(data_cal))     } }
flst
substr(flst[1],21,23)
substr(flst[1],22,25)
substr(flst[1],22,24)
substr(flst,22,24)
paste(substr(flst,22,24),c('_mean',"_sum"))
paste(substr(flst,22,24),c('_mean',"_sum"),separationplot='')
paste(substr(flst,22,24),c('_mean',"_sum"),sep='')
library(ncdf4); library(raster); library(chron); rotate <- function(x) t(apply(x, 2, rev)); path0 <- "d://cru.ts//nc"; setwd(path0); flst <- dir(); path1 <- "d://cru.ts//"; lo_to_ex <- read.csv(paste(path1, "meta_info.csv",sep='')); i3 <- which(!is.na(lo_to_ex$lat)); lo_to_ex2 <- lo_to_ex[i3,]; outp <- matrix(NA, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id)); names(outp) <- c("id", paste(substr(flst, 22, 24), c('_mean', "_sum"), sep = '')); outp$id <- lo_to_ex2$id; for (ijk in 1:length(flst)) {     ncdata <- nc_open(flst[ijk]);     data <- ncvar_get(ncdata);     years <- as.numeric(as.character(years(as.Date(ncdata$dim[[3]]$vals, origin = '1900-01-01'))))     for (ij in 1:length(lo_to_ex2$id)) {         year_search <- lo_to_ex2$year         ii <- which(years %in% year_search)         data_brick <- data[,, ii]         bba <- raster(rotate(rotate(rotate(data[,, ii[1]]))))         extent(bba) <- c(-180, 180, -90, 90)         for (i in 2:length(ii)) {             ccc <- raster(rotate(rotate(rotate(data[,, ii[i]]))));             extent(ccc) <- c(-180, 180, -90, 90)             bba <- stack(bba, ccc);         }         data_cal <- as.numeric(extract(bba, data.frame(x = lo_to_ex$lon[ij], y = lo_to_ex$lat[ij])))         outp[ij,c(2*ijk,2*ijk+1)]=c(mean(data_cal,na.rm=T),sum(data_cal,na.rm=T))     } }
summary(outp)
lo_to
lo_to_ex2
path1 <- "d://cru.ts//"; lo_to_ex <- read.csv(paste(path1, "meta_info.csv", sep = ''),colClasses = c("character","numeric","numeric")); i3 <- which(!is.na(lo_to_ex$lat)); lo_to_ex2 <- lo_to_ex[i3,]; outp <- matrix(NA, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id)); names(outp) <- c("id", paste(substr(flst, 22, 24), c('_mean', "_sum"), sep = '')); outp$id <- lo_to_ex2$id;
i3 <- which(!is.na(lo_to_ex$lat)); lo_to_ex2 <- lo_to_ex[i3,]; outp <- matrix(NA, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id));
outp
i3 <- which(!is.na(lo_to_ex$lat)); lo_to_ex2 <- lo_to_ex[i3,]; outp <- as.data.frame(matrix(NA, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id))); names(outp) <- c("id", paste(substr(flst, 22, 24), c('_mean', "_sum"), sep = '')); outp$id <- lo_to_ex2$id;
outp$id
library(ncdf4); library(raster); library(chron); rotate <- function(x) t(apply(x, 2, rev)); path0 <- "d://cru.ts//nc"; setwd(path0); flst <- dir(); path1 <- "d://cru.ts//"; lo_to_ex <- read.csv(paste(path1, "meta_info.csv", sep = ''),colClasses = c("character","numeric","numeric")); i3 <- which(!is.na(lo_to_ex$lat)); lo_to_ex2 <- lo_to_ex[i3,]; outp <- as.data.frame(matrix(NA, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id))); names(outp) <- c("id", paste(substr(flst, 22, 24), c('_mean', "_sum"), sep = '')); outp$id <- lo_to_ex2$id; for (ijk in 1:length(flst)) {     ncdata <- nc_open(flst[ijk]);     data <- ncvar_get(ncdata);     years <- as.numeric(as.character(years(as.Date(ncdata$dim[[3]]$vals, origin = '1900-01-01'))))     for (ij in 1:length(lo_to_ex2$id)) {         year_search <- lo_to_ex2$year         ii <- which(years %in% year_search)         data_brick <- data[,, ii]         bba <- raster(rotate(rotate(rotate(data[,, ii[1]]))))         extent(bba) <- c(-180, 180, -90, 90)         for (i in 2:length(ii)) {             ccc <- raster(rotate(rotate(rotate(data[,, ii[i]]))));             extent(ccc) <- c(-180, 180, -90, 90)             bba <- stack(bba, ccc);         }         data_cal <- as.numeric(extract(bba, data.frame(x = lo_to_ex$lon[ij], y = lo_to_ex$lat[ij])))         outp[ij,c(2*ijk,2*ijk+1)]=c(mean(data_cal,na.rm=T),sum(data_cal,na.rm=T))     } }
ijk
year
year_search
library(ncdf4); library(raster); library(chron); rotate <- function(x) t(apply(x, 2, rev)); path0 <- "d://cru.ts//nc"; setwd(path0); flst <- dir(); path1 <- "d://cru.ts//"; lo_to_ex <- read.csv(paste(path1, "meta_info.csv", sep = ''),colClasses = c("character","numeric","numeric")); i3 <- which(!is.na(lo_to_ex$lat)); lo_to_ex2 <- lo_to_ex[i3,]; outp <- as.data.frame(matrix(NA, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id))); names(outp) <- c("id", paste(substr(flst, 22, 24), c('_mean', "_sum"), sep = '')); outp$id <- lo_to_ex2$id; for (ijk in 1:length(flst)) {     ncdata <- nc_open(flst[ijk]);     data <- ncvar_get(ncdata);     years <- as.numeric(as.character(years(as.Date(ncdata$dim[[3]]$vals, origin = '1900-01-01'))))     for (ij in 1:length(lo_to_ex2$id)) {         year_search <- lo_to_ex2$year[ij]         ii <- which(years %in% year_search)         data_brick <- data[,, ii]         bba <- raster(rotate(rotate(rotate(data[,, ii[1]]))))         extent(bba) <- c(-180, 180, -90, 90)         for (i in 2:length(ii)) {             ccc <- raster(rotate(rotate(rotate(data[,, ii[i]]))));             extent(ccc) <- c(-180, 180, -90, 90)             bba <- stack(bba, ccc);         }         data_cal <- as.numeric(extract(bba, data.frame(x = lo_to_ex$lon[ij], y = lo_to_ex$lat[ij])))         outp[ij,c(2*ijk,2*ijk+1)]=c(mean(data_cal,na.rm=T),sum(data_cal,na.rm=T))     } }
year
year_search
ii
data_brick
bba
data_cal <- as.numeric(extract(bba, data.frame(x = lo_to_ex2$lon[ij], y = lo_to_ex2$lat[ij]))) )
        data_cal <- as.numeric(extract(bba, data.frame(x = lo_to_ex2$lon[ij], y = lo_to_ex2$lat[ij])))
bba
?extract
data_cal <- as.numeric(extract(bba, data.frame(lo_to_ex2$lon[ij], lo_to_ex2$lat[ij])))
data_cal <- as.numeric(extract(bba, c(lo_to_ex2$lon[ij], lo_to_ex2$lat[ij])))
data_cal <- as.numeric(extract(bba, c(lo_to_ex2$lon[ij], lo_to_ex2$lat[ij])))
ij
lo_to_ex2$lat[ij]
lo_to_ex2$lon[ij]
lo
lo_to_ex2
library(ncdf4); library(raster); library(chron); rotate <- function(x) t(apply(x, 2, rev)); path0 <- "d://cru.ts//nc"; setwd(path0); flst <- dir(); path1 <- "d://cru.ts//"; lo_to_ex <- read.csv(paste(path1, "meta_info.csv", sep = ''),colClasses = c("character","numeric","numeric","numeric")); i3 <- which(!is.na(lo_to_ex$lat)); lo_to_ex2 <- lo_to_ex[i3,]; outp <- as.data.frame(matrix(NA, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id))); names(outp) <- c("id", paste(substr(flst, 22, 24), c('_mean', "_sum"), sep = '')); outp$id <- lo_to_ex2$id; for (ijk in 1:length(flst)) {     ncdata <- nc_open(flst[ijk]);     data <- ncvar_get(ncdata);     years <- as.numeric(as.character(years(as.Date(ncdata$dim[[3]]$vals, origin = '1900-01-01'))))     for (ij in 1:length(lo_to_ex2$id)) {         year_search <- lo_to_ex2$year[ij]         ii <- which(years %in% year_search)         bba <- raster(rotate(rotate(rotate(data[,, ii[1]]))))         extent(bba) <- c(-180, 180, -90, 90)         for (i in 2:length(ii)) {             ccc <- raster(rotate(rotate(rotate(data[,, ii[i]]))));             extent(ccc) <- c(-180, 180, -90, 90)             bba <- stack(bba, ccc);         }         data_cal <- as.numeric(extract(bba, data.frame(x = lo_to_ex2$lon[ij], y = lo_to_ex2$lat[ij])))         outp[ij,c(2*ijk,2*ijk+1)]=c(mean(data_cal,na.rm=T),sum(data_cal,na.rm=T))     } }
data_cal
ij
ijk
c(mean(data_cal, na.rm = T), sum(data_cal, na.rm = T))
outp
flst
outp <- as.data.frame(matrix(NA, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id))); names(outp) <- c("id", paste(substr(flst, 22, 24), rep(c('_mean', "_sum"),length(flst)), sep = ''));
names(outp)
rep(c('_mean', "_sum"),length(flst))
length(flst)
paste(s) outp <- as.data.frame(matrix(NA, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id))); names(outp) <- c("id", paste(substr(flst, 22, 24), rep(c('_mean'), length(flst)), sep = ''),substr(flst, 22, 24), rep(c("_sum"), length(flst)), sep = '')); outp$id <- lo_to_ex2$id;
names(outp) <- c("id", paste(substr(flst, 22, 24), rep(c('_mean'), length(flst)), sep = ''), paste(substr(flst, 22, 24), rep(c("_sum"), length(flst)), sep = ''));
names(outp)
c("id", paste(substr(flst, 22, 24), rep(c('_mean'), length(flst)), sep = ''), paste(substr(flst, 22, 24), rep(c("_sum"), length(flst)), sep = ''));
c("id", paste(substr(flst, 22, 24), rep(c('_mean', "_sum"), length(flst)), sep = ''));
c("id", paste(rep(substr(flst, 22, 24), 2), rep(c('_mean', "_sum"), length(flst)), sep = ''));
rep(substr(flst, 22, 24), 2)
?rep
rep(substr(flst, 22, 24), each=2)
c("id", paste(rep(substr(flst, 22, 24), each = 2), rep(c('_mean', "_sum"), length(flst)), sep = ''));
outp <- as.data.frame(matrix(NA, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id))); names(outp) <- c("id", paste(rep(substr(flst, 22, 24),each=2), rep(c('_mean', "_sum"),length(flst)), sep = '')); outp$id <- lo_to_ex2$id;
summary(outp)
outp <- as.data.frame(matrix(NA, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id))); names(outp) <- c("id", paste(rep(substr(flst, 22, 24),each=2), rep(c('_mean', "_sum"),length(flst)), sep = '')); row.names(outp)<- lo_to_ex2$id;
summary(outp)
rm(outp)
c("id", paste(rep(substr(flst, 22, 24), each = 2), rep(c('_mean', "_sum"), length(flst)), sep = ''));
>  outp <- as.data.frame(matrix(NA, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id))); names(outp) <- c("id", paste(rep(substr(flst, 22, 24),each=2), rep(c('_mean', "_sum"),length(flst)), sep = '')); row.names(outp)<- lo_to_ex2$id;
outp <- as.data.frame(matrix(NA, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id))); names(outp) <- c("id", paste(rep(substr(flst, 22, 24),each=2), rep(c('_mean', "_sum"),length(flst)), sep = '')); row.names(outp)<- lo_to_ex2$id;
outp
class(outp)
summary(outp)
outp <- as.data.frame(matrix(0, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id))); names(outp) <- c("id", paste(rep(substr(flst, 22, 24),each=2), rep(c('_mean', "_sum"),length(flst)), sep = '')); row.names(outp)<- lo_to_ex2$id;
summary(outp)
outp$id <- lo_to_ex2$id;
summary(outp)
library(ncdf4); library(raster); library(chron); rotate <- function(x) t(apply(x, 2, rev)); path0 <- "d://cru.ts//nc"; setwd(path0); flst <- dir(); path1 <- "d://cru.ts//"; lo_to_ex <- read.csv(paste(path1, "meta_info.csv", sep = ''),colClasses = c("character","numeric","numeric","numeric")); i3 <- which(!is.na(lo_to_ex$lat)); lo_to_ex2 <- lo_to_ex[i3,]; outp <- as.data.frame(matrix(0, ncol = 2 * length(flst) + 1, nrow = length(lo_to_ex2$id))); names(outp) <- c("id", paste(rep(substr(flst, 22, 24),each=2), rep(c('_mean', "_sum"),length(flst)), sep = '')); row.names(outp) <- lo_to_ex2$id; outp$id <- lo_to_ex2$id; for (ijk in 1:length(flst)) {     ncdata <- nc_open(flst[ijk]);     data <- ncvar_get(ncdata);     years <- as.numeric(as.character(years(as.Date(ncdata$dim[[3]]$vals, origin = '1900-01-01'))))     for (ij in 1:length(lo_to_ex2$id)) {         year_search <- lo_to_ex2$year[ij]         ii <- which(years %in% year_search)         bba <- raster(rotate(rotate(rotate(data[,, ii[1]]))))         extent(bba) <- c(-180, 180, -90, 90)         for (i in 2:length(ii)) {             ccc <- raster(rotate(rotate(rotate(data[,, ii[i]]))));             extent(ccc) <- c(-180, 180, -90, 90)             bba <- stack(bba, ccc);         }         data_cal <- as.numeric(extract(bba, data.frame(x = lo_to_ex2$lon[ij], y = lo_to_ex2$lat[ij])))         outp[ij,c(2*ijk,2*ijk+1)]=c(mean(data_cal,na.rm=T),sum(data_cal,na.rm=T))     } }
ij
2*ijk
2*ijk+1
outp[ij,c(2,3)]
outp[ij, c(2 * ijk, 2 * ijk + 1)] = c(mean(data_cal, na.rm = T), sum(data_cal, na.rm = T))
        year_search <- lo_to_ex2$year[ij]         ii <- which(years %in% year_search)         bba <- raster(rotate(rotate(rotate(data[,, ii[1]]))))         extent(bba) <- c(-180, 180, -90, 90)         for (i in 2:length(ii)) {             ccc <- raster(rotate(rotate(rotate(data[,, ii[i]]))));             extent(ccc) <- c(-180, 180, -90, 90)             bba <- stack(bba, ccc);         }         data_cal <- as.numeric(extract(bba, data.frame(x = lo_to_ex2$lon[ij], y = lo_to_ex2$lat[ij])))         outp[ij,c(2*ijk,2*ijk+1)]=c(mean(data_cal,na.rm=T),sum(data_cal,na.rm=T))
rm(data_cal)
        year_search <- lo_to_ex2$year[ij]         ii <- which(years %in% year_search)         bba <- raster(rotate(rotate(rotate(data[,, ii[1]]))))         extent(bba) <- c(-180, 180, -90, 90)         for (i in 2:length(ii)) {             ccc <- raster(rotate(rotate(rotate(data[,, ii[i]]))));             extent(ccc) <- c(-180, 180, -90, 90)             bba <- stack(bba, ccc);         }         data_cal <- as.numeric(extract(bba, data.frame(x = lo_to_ex2$lon[ij], y = lo_to_ex2$lat[ij])))         outp[ij,c(2*ijk,2*ijk+1)]=c(mean(data_cal,na.rm=T),sum(data_cal,na.rm=T))
data_c
data_cal
?extract
        data_cal <- as.numeric(extract(bba, data.frame(x = lo_to_ex2$lon[ij], y = lo_to_ex2$lat[ij])), method = 'bilinear')         outp[ij,c(2*ijk,2*ijk+1)]=c(mean(data_cal,na.rm=T),sum(data_cal,na.rm=T))
outp
data_cal
lo
lo_to_ex2$id[14]
source("D:/cru.ts/data_extr/data_extr/main.R", echo = TRUE, encoding = "GB18030")
source("D:/cru.ts/data_extr/data_extr/main.R", echo = TRUE, encoding = "GB18030")
?try
source("D:/cru.ts/data_extr/data_extr/main.R", echo = TRUE, encoding = "GB18030")
atry
source("D:/cru.ts/data_extr/data_extr/main.R", echo = TRUE, encoding = "GB18030")
